"use strict";(self.webpackChunkcurator_site=self.webpackChunkcurator_site||[]).push([[9516],{5442:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>i});const t=JSON.parse('{"id":"modeled-components","title":"Modeled Curator - Components","description":"Modeled Curator components are intended to allow you to model your ZooKeeper usage early in your application so that the majority of the code that interacts with ZooKeeper doesn\'t need to be concerned with paths, byte arrays, ACLs, options, etc. The Pub-Sub Example can give you some ideas on how to accomplish this.","source":"@site/docs/modeled-components.md","sourceDirName":".","slug":"/modeled-components","permalink":"/docs/modeled-components","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/curator-site/tree/main/docs/modeled-components.md","tags":[],"version":"current","lastUpdatedBy":"tison","lastUpdatedAt":1740614244000,"frontMatter":{"displayed_sidebar":"docs"},"sidebar":"docs"}');var d=n(5105),o=n(6413);const r={displayed_sidebar:"docs"},s="Modeled Curator - Components",l={},i=[{value:"ZPath",id:"zpath",level:2},{value:"NodeName",id:"nodename",level:3},{value:"Partial Resolution",id:"partial-resolution",level:3},{value:"ModelSpec",id:"modelspec",level:2},{value:"JacksonModelSerializer",id:"jacksonmodelserializer",level:3},{value:"ModeledFramework",id:"modeledframework",level:2},{value:"Partially Resolved ZPaths and Set/Update",id:"partially-resolved-zpaths-and-setupdate",level:3},{value:"Caching and Typed Parameters",id:"caching-and-typed-parameters",level:2}];function c(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(a.header,{children:(0,d.jsx)(a.h1,{id:"modeled-curator---components",children:"Modeled Curator - Components"})}),"\n",(0,d.jsxs)(a.p,{children:["Modeled Curator components are intended to allow you to model your ZooKeeper usage early in your application so that the majority of the code that interacts with ZooKeeper doesn't need to be concerned with paths, byte arrays, ACLs, options, etc. The ",(0,d.jsx)(a.a,{href:"https://github.com/apache/curator/tree/master/curator-examples/src/main/java/pubsub",children:"Pub-Sub Example"})," can give you some ideas on how to accomplish this."]}),"\n",(0,d.jsx)(a.h2,{id:"zpath",children:"ZPath"}),"\n",(0,d.jsxs)(a.p,{children:["Instead of using raw string paths, Modeled Curator defines the ",(0,d.jsx)(a.code,{children:"ZPath"})," interface that abstracts ZooKeeper paths. ZPaths can be simple static paths or can contain parameters that can be replaced as needed."]}),"\n",(0,d.jsx)(a.p,{children:"To build a simple static path, use:"}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:'ZPath path = ZPath.parse("/my/static/path");\n'})}),"\n",(0,d.jsxs)(a.p,{children:["To build a path with parameters, use. ",(0,d.jsx)(a.code,{children:"ZPath.parseWithIds()"})," using the value ",(0,d.jsx)(a.code,{children:'"{XXXX}"'})," to denote a parameter. You can then use the ",(0,d.jsx)(a.code,{children:"resolve()"})," method to replace the parameters. The value between ",(0,d.jsx)(a.code,{children:'"{}"'})," can be any value. E.g.,"]}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:'ZPath path = ZPath.parseWithIds("/foo/{first param}/bar/{second param}");\nZPath resolvedPath = path.resolve(param1, param2);\n'})}),"\n",(0,d.jsx)(a.h3,{id:"nodename",children:"NodeName"}),"\n",(0,d.jsxs)(a.p,{children:["Parameters are resolved by calling ",(0,d.jsx)(a.code,{children:"toString()"})," on the parameter. You can use ",(0,d.jsx)(a.code,{children:"NodeName"})," to change this behavior. If a parameter implements ",(0,d.jsx)(a.code,{children:"NodeName"})," the ",(0,d.jsx)(a.code,{children:"nodeName()"})," method is used as the parameter value."]}),"\n",(0,d.jsx)(a.h3,{id:"partial-resolution",children:"Partial Resolution"}),"\n",(0,d.jsx)(a.p,{children:"ZPaths can be partially resolved. E.g.,"}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:'ZPath path = ZPath.parseWithIds("/foo/{type}/bar/{id}");\nZPath partial = path.resolve("standard");\n// partial is now "/foo/standard/bar/{id}"\n'})}),"\n",(0,d.jsxs)(a.p,{children:[(0,d.jsx)(a.a,{href:"#modeledframework",children:"ModeledFramework"})," takes advantage of this. See below for details."]}),"\n",(0,d.jsx)(a.h2,{id:"modelspec",children:"ModelSpec"}),"\n",(0,d.jsxs)(a.p,{children:["A ",(0,d.jsx)(a.code,{children:"ModelSpec"})," contains all the metadata needed to operate on a ZooKeeper path:"]}),"\n",(0,d.jsxs)(a.ul,{children:["\n",(0,d.jsx)(a.li,{children:"A ZPath"}),"\n",(0,d.jsx)(a.li,{children:"A serializer for the data stored at the path"}),"\n",(0,d.jsx)(a.li,{children:"Options for how nodes should be created (sequential, compressed data, ttl, etc.)"}),"\n",(0,d.jsx)(a.li,{children:"ACLs for the nodes at the path"}),"\n",(0,d.jsx)(a.li,{children:"Options for how to delete nodes (guaranteed, deleting children, etc.)"}),"\n"]}),"\n",(0,d.jsx)(a.p,{children:"ModelSpec instances are created via a builder. The builder sets defaults that should be useful for most applications but you can alter any of these as needed."}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:"// a standard model spec for the given path and serializer\n// the model spec will have no ACLs and the options:\n// * createParentsAsContainers\n// * setDataIfExists\n// * DeleteOption.guaranteed\nModelSpec<MyModel> spec = ModelSpec.builder(path, JacksonModelSerializer.build(MyModel.class)).build();\n"})}),"\n",(0,d.jsxs)(a.p,{children:["As a convenience, ModelSpec provides ",(0,d.jsx)(a.code,{children:"resolve()"})," methods in case the ZPath used has parameters. E.g.,"]}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:'ZPath path = ZPath.parseWithIds("/foo/{id}/bar/{id}");\nModelSpec<MyModel> spec = ModelSpec.builder(path, JacksonModelSerializer.build(MyModel.class)).build();\nModelSpec<MyModel> resolvedSpec = spec.resolve(param1, param2);\n'})}),"\n",(0,d.jsx)(a.h3,{id:"jacksonmodelserializer",children:"JacksonModelSerializer"}),"\n",(0,d.jsxs)(a.p,{children:["A Jackson serializer, ",(0,d.jsx)(a.code,{children:"JacksonModelSerializer"}),', is included. However, the Jackson dependency for it is specified as "provided" in the curator-x-async Maven POM file to avoid adding a new dependency to Curator. Therefore, if you wish to use the JacksonModelSerializer you must manually add the dependency to your build system.']}),"\n",(0,d.jsx)(a.p,{children:"E.g., for Maven:"}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-xml",children:"<dependency>\n    <groupId>com.fasterxml.jackson.core</groupId>\n    <artifactId>jackson-databind</artifactId>\n    <version>${jackson.version}</version>\n</dependency>\n"})}),"\n",(0,d.jsx)(a.h2,{id:"modeledframework",children:"ModeledFramework"}),"\n",(0,d.jsxs)(a.p,{children:[(0,d.jsx)(a.code,{children:"ModeledFramework"})," ties together all the metadata into a Curator-style instance that is used to perform ZooKeeper operations. E.g.,"]}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:"ModeledFramework<MyModel> modeledClient = ModeledFramework.wrap(client, myModelSpec);\nMyModel instance = ...;\nmodeledClient.set(instance);\n"})}),"\n",(0,d.jsx)(a.p,{children:'The "set" call in the above example is the equivalent of:'}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:'MyModel instance = ...;\nString path = "/foo/bar/" + instance.getId();\nbyte[] data = serializer.serialize(instance);\nclient.create()\n    .withOptions(Sets.newHashSet(CreateOption.createParentsAsContainers, CreateOption.setDataIfExists))\n    .forPath(path, data);\n'})}),"\n",(0,d.jsx)(a.p,{children:"To get a value:"}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:'ModeledFramework<MyModel> modeledClient = ModeledFramework.wrap(client, myModelSpec);\nmodeledClient.read().whenComplete((value, e) -> {\n    if (e != null) {\n        // handle the error\n    } else {\n        // "value" is the MyModel instance\n    }\n});\n'})}),"\n",(0,d.jsx)(a.p,{children:'The "read" call in the above example is the equivalent of:'}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:'String path = "/foo/bar/" + instanceId;\nclient.getData().forPath(path).whenComplete((data, e) -> {\n    if (e != null) {\n        // handle the error\n    } else {\n        // NOTE: you must deal with possible deserialization problems\n        // caused by clients that write bad data\n        // If all of your code uses ModeledFramework you can guarantee that\n        // the data is always correctly written\n        MyModel model = serializer.deserialize(data);\n        // ...\n    }\n});\n'})}),"\n",(0,d.jsx)(a.h3,{id:"partially-resolved-zpaths-and-setupdate",children:"Partially Resolved ZPaths and Set/Update"}),"\n",(0,d.jsxs)(a.p,{children:["ModeledFramework's various ",(0,d.jsx)(a.code,{children:"set"})," and ",(0,d.jsx)(a.code,{children:"update"})," methods check for unresolved ZPaths. If the current modelSpec has an unresolved ZPath when set/update is called, it is automatically resolved using the model instance being set/updated. E.g.,"]}),"\n",(0,d.jsx)(a.pre,{children:(0,d.jsx)(a.code,{className:"language-java",children:'ZPath path = ZPath.parseWithIds("/root/{type}/instance/{id}");\nModelSpec<MyModel> modelSpec = ModelSpec.builder(path, serializer);\nModeledFramework<MyModel> modeledClient = ModeledFramework.wrap(modelSpec, client, modelSpec);\nString currentType = ...;\nMyModel model = ...;\nmodeledClient.resolved(currentType).set(model); // internally, ModeledFramework calls ZPath.resolved()\n                                                // using "model" as the argument to get the actual ZPath\n\n'})}),"\n",(0,d.jsx)(a.h2,{id:"caching-and-typed-parameters",children:"Caching and Typed Parameters"}),"\n",(0,d.jsxs)(a.p,{children:["In addition to the above features, Modeled Curator supports Integrated Caching, Typed Parameters and Versioning. See ",(0,d.jsx)(a.a,{href:"/docs/modeled-typed",children:"Caching and Typed Parameters"})," for details."]})]})}function h(e={}){const{wrapper:a}={...(0,o.R)(),...e.components};return a?(0,d.jsx)(a,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},6413:(e,a,n)=>{n.d(a,{R:()=>r,x:()=>s});var t=n(8101);const d={},o=t.createContext(d);function r(e){const a=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function s(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),t.createElement(o.Provider,{value:a},e.children)}}}]);