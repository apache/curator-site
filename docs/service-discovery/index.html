<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-service-discovery" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Service Discovery | Apache Curator</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://curator.apache.org/img/curator-highres.png"><meta data-rh="true" name="twitter:image" content="https://curator.apache.org/img/curator-highres.png"><meta data-rh="true" property="og:url" content="https://curator.apache.org/docs/service-discovery"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Service Discovery | Apache Curator"><meta data-rh="true" name="description" content="Packaging"><meta data-rh="true" property="og:description" content="Packaging"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://curator.apache.org/docs/service-discovery"><link data-rh="true" rel="alternate" href="https://curator.apache.org/docs/service-discovery" hreflang="en"><link data-rh="true" rel="alternate" href="https://curator.apache.org/docs/service-discovery" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e9c959c9.css">
<script src="/assets/js/runtime~main.e0293a4d.js" defer="defer"></script>
<script src="/assets/js/main.800887a4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/curator-logo.svg"><link rel="preload" as="image" href="/img/asf-logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_KQtv" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/curator-logo.svg" alt="Apache Curator" class="themedComponent_ZSL4 themedComponent--light_AQLr"><img src="/img/curator-logo.svg" alt="Apache Curator" class="themedComponent_ZSL4 themedComponent--dark_gpKV"></div></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/about">Documentation</a><a class="navbar__item navbar__link" href="/community/">Community</a><a class="navbar__item navbar__link" href="/download">Download</a><a href="https://github.com/apache/curator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_AVaE"><div class="navbar__search searchBarContainer_RD6Q" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_Ie2e" value=""><div class="loadingRing_j_qW searchBarLoadingRing_F6zD"><div></div><div></div><div></div><div></div></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_b4gy"><div class="docsWrapper__I7V"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_e29F" type="button"></button><div class="docRoot__Y5c"><aside class="theme-doc-sidebar-container docSidebarContainer_Fr8P"><div class="sidebarViewport_lmai"><div class="sidebar_Jsxa"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_B5vv"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/about">About</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/examples">Examples</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/recipes">Recipes</a><button aria-label="Expand sidebar category &#x27;Recipes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/async">Curator Async</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/modeled">Strongly Typed Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/migrations">Migrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/schema">Schema Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_wn3H menu__list-item">LOW LEVEL</li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/framework">Framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/utilities">Utilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/client">Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_wn3H menu__list-item">DETAILS</li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/errors">Error Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/logging">Logging and Tracing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/tech-notes">Tech Notes</a><button aria-label="Expand sidebar category &#x27;Tech Notes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zk-compatibility-34">ZooKeeper 3.4.x</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/breaking-changes">Breaking Changes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="/apidocs/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_zOuC">Javadoc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mVQh"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://cwiki.apache.org/confluence/display/CURATOR" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_zOuC">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mVQh"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menuHtmlItem_wn3H menu__list-item">EXTENSIONS</li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/service-discovery">Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/service-discovery-server">Service Discovery Server</a></li></ul></nav></div></div></aside><main class="docMainContainer_JEvH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_s1kn"><div class="docItemContainer_XSQV"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_XW_x" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_bUXf"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Service Discovery</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_Jqnc theme-doc-toc-mobile tocMobile_FtGK"><button type="button" class="clean-btn tocCollapsibleButton_Ncl6">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Service Discovery</h1></header>
<h2 class="anchor anchorWithStickyNavbar_YyTq" id="packaging">Packaging<a href="#packaging" class="hash-link" aria-label="Direct link to Packaging" title="Direct link to Packaging">​</a></h2>
<p>Curator Service Discovery is in its own package in Maven Central: curator-x-discovery</p>
<h2 class="anchor anchorWithStickyNavbar_YyTq" id="what-is-a-discovery-service">What Is a Discovery Service?<a href="#what-is-a-discovery-service" class="hash-link" aria-label="Direct link to What Is a Discovery Service?" title="Direct link to What Is a Discovery Service?">​</a></h2>
<p>In SOA/distributed systems, services need to find each other. i.e. a web service might need to find a caching service, etc. DNS can be used for this but it is nowhere near flexible enough for services that are constantly changing. A Service Discovery system provides a mechanism for:</p>
<ul>
<li>Services to register their availability</li>
<li>Locating a single instance of a particular service</li>
<li>Notifying when the instances of a service change</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_YyTq" id="curator-service-discovery">Curator Service Discovery<a href="#curator-service-discovery" class="hash-link" aria-label="Direct link to Curator Service Discovery" title="Direct link to Curator Service Discovery">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_YyTq" id="serviceinstance">ServiceInstance<a href="#serviceinstance" class="hash-link" aria-label="Direct link to ServiceInstance" title="Direct link to ServiceInstance">​</a></h3>
<p>A service instance is represented by the class: <code>ServiceInstance</code>. ServiceInstances have a name, id, address, port and/or ssl port, and an optional payload (user defined). ServiceInstances are serialized and stored in ZooKeeper in the following way:</p>
<div class="language-text codeBlockContainer_rc0e theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_xqWF"><pre tabindex="0" class="prism-code language-text codeBlock_LjVW thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_oX32"><span class="token-line" style="color:#393A34"><span class="token plain">base path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       |_______ service A name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    |__________ instance 1 id --&gt; (serialized ServiceInstance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    |__________ instance 2 id --&gt; (serialized ServiceInstance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    |__________ ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       |_______ service B name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    |__________ instance 1 id --&gt; (serialized ServiceInstance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    |__________ instance 2 id --&gt; (serialized ServiceInstance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    |__________ ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       |_______ ...</span><br></span></code></pre><div class="buttonGroup_FGwN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_yZcd" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N0Ng"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Q5G_"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_YyTq" id="serviceprovider">ServiceProvider<a href="#serviceprovider" class="hash-link" aria-label="Direct link to ServiceProvider" title="Direct link to ServiceProvider">​</a></h3>
<p>The main abstraction class is <code>ServiceProvider</code>. It encapsulates the discovery service for a particular named service along with a provider strategy. A provider strategy is a scheme for selecting one instance from a set of instances for a given service. There are three bundled strategies: Round Robin, Random and Sticky (always selects the same one).</p>
<p>ServiceProviders are allocated by using a <code>ServiceProviderBuilder</code>. You obtain a ServiceProviderBuilder from the ServiceDiscovery (see below). The ServiceProviderBuilder allows you to set the service name and several other optional values.</p>
<p>The ServiceProvider must be started by calling <code>start()</code>. When finished you should call <code>close()</code>. The only method in ServiceProvider is:</p>
<div class="language-java codeBlockContainer_rc0e theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_xqWF"><pre tabindex="0" class="prism-code language-java codeBlock_LjVW thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_oX32"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Return an instance for a single use. IMPORTANT: users should not hold on to the instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// returned. A fresh instance should always be retrieved.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ServiceInstance</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FGwN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_yZcd" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N0Ng"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Q5G_"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_zTag alert alert--secondary"><div class="admonitionHeading_wQX5"><span class="admonitionIcon_Zl1m"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_wro9"><p>When using Curator 2.x (Zookeeper 3.4.x) it&#x27;s essential that service provider objects are cached by your application and reused. Since the internal NamespaceWatcher objects added by the service provider cannot be removed in Zookeeper 3.4.x, creating a fresh service provider for each call to the same service will eventually exhaust the memory of the JVM.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_YyTq" id="servicediscovery">ServiceDiscovery<a href="#servicediscovery" class="hash-link" aria-label="Direct link to ServiceDiscovery" title="Direct link to ServiceDiscovery">​</a></h3>
<p>In order to allocate a ServiceProvider, you must have a ServiceDiscovery. It is created by a <code>ServiceDiscoveryBuilder</code>.</p>
<p>You must call <code>start()</code> on the object and, when done with it, call <code>close()</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_YyTq" id="instance-stability">Instance Stability<a href="#instance-stability" class="hash-link" aria-label="Direct link to Instance Stability" title="Direct link to Instance Stability">​</a></h3>
<p>If a particular instance has an I/O error, etc. you should call <code>ServiceProvider.noteError()</code> passing in the instance. The ServiceProvider will temporarily consider instances that have errors to be &quot;down&quot;. The thresholds and timeouts for down instances are set via the <code>DownInstancePolicy</code> which can be passed to <code>ServiceProviderBuilder</code> (note: a default DownInstancePolicy is used if you don&#x27;t specify one).</p>
<h2 class="anchor anchorWithStickyNavbar_YyTq" id="low-level-apis">Low Level APIs<a href="#low-level-apis" class="hash-link" aria-label="Direct link to Low Level APIs" title="Direct link to Low Level APIs">​</a></h2>
<p>The ServiceProvider API is all you should need for most purposes. However, for finer grained control, you can use these methods:</p>
<h3 class="anchor anchorWithStickyNavbar_YyTq" id="registeringunregistering-services">Registering/Unregistering Services<a href="#registeringunregistering-services" class="hash-link" aria-label="Direct link to Registering/Unregistering Services" title="Direct link to Registering/Unregistering Services">​</a></h3>
<p>Normally, you pass your application&#x27;s service descriptor to the ServiceDiscovery constructor and it will get registered/unregistered automatically. If, though, you need to manually do this, use these methods:</p>
<div class="language-java codeBlockContainer_rc0e theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_xqWF"><pre tabindex="0" class="prism-code language-java codeBlock_LjVW thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_oX32"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Register/re-register/update a service instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Parameters:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// service - service to add</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">registerService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ServiceInstance</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Unregister/remove a service instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Parameters:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// service - the service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">unregisterService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ServiceInstance</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FGwN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_yZcd" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N0Ng"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Q5G_"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_YyTq" id="querying-for-services">Querying for Services<a href="#querying-for-services" class="hash-link" aria-label="Direct link to Querying for Services" title="Direct link to Querying for Services">​</a></h3>
<p>You can query for all service names, all instances of a particular service, or single service instance.</p>
<div class="language-java codeBlockContainer_rc0e theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_xqWF"><pre tabindex="0" class="prism-code language-java codeBlock_LjVW thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_oX32"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Return the names of all known services</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Collection</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">queryForNames</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Return all known instances for the given service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Parameters:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// name - name of the service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Collection</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">ServiceInstance</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">queryForInstances</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Return the service instance POJO or null if not found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Parameters:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// name - name of the service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// id - ID of the instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ServiceInstance</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">queryForInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FGwN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_yZcd" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N0Ng"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Q5G_"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_YyTq" id="service-cache">Service Cache<a href="#service-cache" class="hash-link" aria-label="Direct link to Service Cache" title="Direct link to Service Cache">​</a></h3>
<p>Each of the above query methods calls ZooKeeper directly. If you need more than occasional querying of services you can use the <code>ServiceCache</code>. It caches in memory the list of instances for a particular service. It uses a Watcher to keep the list up to date.</p>
<p>You allocate a ServiceCache via the builder returned by <code>ServiceDiscovery.serviceCacheBuilder()</code>. The ServiceCache object must be started by calling <code>start()</code> and, when done, you should call <code>close()</code>. You can get the currently known list of instances for the service by calling:</p>
<div class="language-java codeBlockContainer_rc0e theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_xqWF"><pre tabindex="0" class="prism-code language-java codeBlock_LjVW thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_oX32"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Return the current list of instances. NOTE: there is no guarantee of freshness. This is merely</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// the last known list of instances. However, the list is updated via a ZooKeeper watcher so it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// should be fresh within a window of a second or two.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">Collection</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">ServiceInstance</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getInstances</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_FGwN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_yZcd" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N0Ng"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Q5G_"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ServiceCache supports a listener that gets notified when Watcher has updated the list of instances:</p>
<div class="language-java codeBlockContainer_rc0e theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_xqWF"><pre tabindex="0" class="prism-code language-java codeBlock_LjVW thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_oX32"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** Listener for changes to a service cache */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">ServiceCacheListener</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">ConnectionStateListener</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** Called when the cache has changed (instances added/deleted, etc.) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cacheChanged</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_FGwN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_yZcd" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N0Ng"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Q5G_"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/apache/curator-site/tree/main/docs/service-discovery.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_isnH" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JENK"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-07-23T20:02:53.000Z" itemprop="dateModified">Jul 23, 2025</time></b> by <b>Kezhu Wang</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/breaking-changes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Breaking Changes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/service-discovery-server"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Service Discovery Server</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_v_Ze thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#packaging" class="table-of-contents__link toc-highlight">Packaging</a></li><li><a href="#what-is-a-discovery-service" class="table-of-contents__link toc-highlight">What Is a Discovery Service?</a></li><li><a href="#curator-service-discovery" class="table-of-contents__link toc-highlight">Curator Service Discovery</a><ul><li><a href="#serviceinstance" class="table-of-contents__link toc-highlight">ServiceInstance</a></li><li><a href="#serviceprovider" class="table-of-contents__link toc-highlight">ServiceProvider</a></li><li><a href="#servicediscovery" class="table-of-contents__link toc-highlight">ServiceDiscovery</a></li><li><a href="#instance-stability" class="table-of-contents__link toc-highlight">Instance Stability</a></li></ul></li><li><a href="#low-level-apis" class="table-of-contents__link toc-highlight">Low Level APIs</a><ul><li><a href="#registeringunregistering-services" class="table-of-contents__link toc-highlight">Registering/Unregistering Services</a></li><li><a href="#querying-for-services" class="table-of-contents__link toc-highlight">Querying for Services</a></li><li><a href="#service-cache" class="table-of-contents__link toc-highlight">Service Cache</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" rel="noopener noreferrer" class="footerLogoLink_xpRF"><img src="/img/asf-logo.svg" alt="Apache logo" class="footer__logo themedComponent_ZSL4 themedComponent--light_AQLr" height="128px"><img src="/img/asf-logo.svg" alt="Apache logo" class="footer__logo themedComponent_ZSL4 themedComponent--dark_gpKV" height="128px"></a></div><div class="footer__copyright">Apache Curator, the Apache feather logo, and the Apache Curator project logos are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.</div></div></div></footer></div>
</body>
</html>